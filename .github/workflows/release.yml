name: Release Build

on:
  push:
    tags:
      - 'v*.*.*'  # è§¦å‘æ¡ä»¶: æ¨é€ v0.0.1 ç­‰ç‰ˆæœ¬ tag
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

permissions:
  contents: write  # å…è®¸åˆ›å»º Release


jobs:
  build-and-release:
    runs-on: windows-2022  # ä½¿ç”¨ VS 2022 ç¯å¢ƒ
    
    steps:
    - name: Checkout Code
      uses: actions/checkout@v4
      with:
        submodules: recursive
    
    - name: Setup MSVC
      uses: microsoft/setup-msbuild@v2
    
    - name: Configure CMake
      run: |
        cmake -B build -S . -DCMAKE_BUILD_TYPE=Release -A x64
    
    - name: Build Release
      run: |
        cmake --build build --config Release
    
    - name: Install to Distribution Directory
      run: |
        cmake --install build --prefix ./dist/NeteaseHookSDK-${{ github.ref_name }} --config Release
    
    - name: Package Release
      run: |
        cd dist
        Compress-Archive -Path NeteaseHookSDK-${{ github.ref_name }} -DestinationPath NeteaseHookSDK-${{ github.ref_name }}-windows-x64.zip
    
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        files: |
          dist/NeteaseHookSDK-${{ github.ref_name }}-windows-x64.zip
        body: |
          ## NeteaseHookSDK ${{ github.ref_name }}
          
          ### ğŸ“¦ å‘å¸ƒåŒ…å†…å®¹
          - `bin/` - DLL æ–‡ä»¶ (NeteaseDriver.dll, version.dll)
          - `include/` - C/C++ å¤´æ–‡ä»¶
          - `lib/` - Import Library
          - `docs/` - å®Œæ•´æ–‡æ¡£
          - `examples/` - C è¯­è¨€ç¤ºä¾‹ä»£ç 
          
          ### ğŸ”§ ç³»ç»Ÿè¦æ±‚
          - Windows 7+ (x64)
          - MSVC Runtime (é€šå¸¸å·²é¢„è£…)
          - ç½‘æ˜“äº‘éŸ³ä¹å®¢æˆ·ç«¯
          
          ### ğŸ“– å¿«é€Ÿå¼€å§‹
          1. ä¸‹è½½å¹¶è§£å‹ zip åŒ…
          2. å‚è€ƒ `examples/c_demo.c` é›†æˆåˆ°æ‚¨çš„é¡¹ç›®
          3. è¯¦ç»†æ–‡æ¡£è§ `docs/API.md`
          
          ### âš–ï¸ è®¸å¯è¯
          MIT License - ä»…ä¾›å­¦ä¹ ç ”ç©¶ç”¨é€”
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
